---
categories:
  - review
date: '2025-02-15'
title: i18으로 다국어 기능 구현하기
description: i18next 라이브러리를 사용하여 다국어 기능을 구현했습니다. 또한, 서버사이드 렌더링, 클라이언트 사이드 렌더링에서 동작하도록 구현헀는 것을 기반으로 글을 작성했습니다.
thumbnail: '/images/thumbnail/i18n.png'
slug: i18n
tags:
  - i18n
---

# 도입

- i18next로 다국어 기능을 도입해보자

<br/>

## i18next로 다국어 기능을 구현하기 전에 어떤 방법을 고려했나요?

- 저는 단순히 다국어 기능을 구현하기 위해서 상수 파일을 만들어서 다국어 기능을 구현하고자 생각했습니다.

```ts
// constants
const LANGUAGES = {
  LOGIN: {
    KR: '로그인 페이지에 오신것을 환영합니다.',
    EN: 'Welcome to Login Page'
  },
  ...
}
```

- 하지만 상수로 파일을 구현할 경우 조건식을 이용해서 다국어 기능을 구현해야했기때문에 코드 가독성 측면에서 좋지 않을 것으로 생각을 했습니다.
- example
  - `<div>{LOCALE === 'KR' ? LANGUAGES.KR : LANGUAGES.EN}</div>`

## 그래서 제가 접근방식은 무엇인가요?

### i18next, react-i18next 사용했습니다.

- `react-i18next`를 사용해서 다국어 기능을 구현하고자 했습니다.

```ts
// 이런식으로 말이죠.
import i18next from 'i18next';

i18next.init({
  lng: 'en', // if you're using a language detector, do not define the lng option
  debug: true,
  resources: {
    en: {
      translation: {
        key: 'hello world',
      },
    },
  },
});
// initialized and ready to go!
// i18next is already initialized, because the translation resources where passed via init function
document.getElementById('output').innerHTML = i18next.t('key');
```

-하지만 저는 클라이언트 사이드 렌더링과 서버 사이드 렌더링에 맞춰서 렌더링을 구현해야했기 때문에 별도의 작업이 필요했습니다.

### 클라이언트 사이드 렌더링에서의 react-i18next 사용

```ts
/* eslint-disable @typescript-eslint/await-thenable */

import i18next from 'i18next';
import LanguageDetector from 'i18next-browser-languagedetector';
import resourcesToBackend from 'i18next-resources-to-backend';
import { useTranslation } from 'react-i18next';
import { initReactI18next } from 'react-i18next/initReactI18next';

import { getI18nOptions, locales, LocaleTypes } from './setting';

const runOnServer = typeof window === 'undefined';

i18next
  .use(initReactI18next) // react-i18next 으로 초기화
  .use(LanguageDetector) // 사용자 언어 찾기
  .use(resourcesToBackend((_locale: string, _namespace: string) => import(`./resources/${_namespace}/${_locale}.json`)))
  .init({
    ...getI18nOptions(),
    lng: undefined, // detect the language on the client
    detection: {
      order: ['path'],
    },
    preload: runOnServer ? locales : [],
  })
  .catch(err => {
    console.error('다국어 지원이 되지 않습니다.', err);
  });

export const useClientTranslation = (locale: LocaleTypes, namespace: string) => {
  const translation = useTranslation(namespace);
  const { i18n } = translation;

  if (runOnServer && locale) {
    i18n.changeLanguage(locale).catch(err => console.log(err));
  }

  return translation;
};
```

- 다른 기능 추가는 별로 다를게 없습니다. 그러나 중요한 점은, 서버에서 동작하는 것인지 아닌지 판단하는 것이 필요합니다.
- init 캐스캐이드 메서드로 초기화를 진행할 때, 현재 서버에서 실행(runOnServer)이라면 `locales` 변수에 적힌 배열을 받고, 그렇지 않으면 빈배열을 받게합니다.
- 그리고 `useClientTranslation` 훅을 이용해서 다국어 기능을 구현할 때, 서버에서 돌아간다면 locale을 변경하는 로직을 추가했습니다.
  - 그 이유는 next.js 에서 `use client`를 최상단에 작성하더라도 nextjs에서는 서버에서 DOM트리를 렌더링하고 클라이언트에서 만들어야하는 것은 별도로 만들기 때문에 해당 로직이 필요합니다.
